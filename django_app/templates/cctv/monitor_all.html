{% extends 'cctv/base.html' %}

{% block title %}전지점 모니터링 - Hotel CCTV Monitoring{% endblock %}

{% block content %}
<div class="panel">
    <div class="page-header">
        <div>
            <p class="eyebrow">실시간 모니터링</p>
            <h1>전지점</h1>
        </div>
    </div>
    <div class="monitor-filters">
        <div class="monitor-filter">
            <label>지역</label>
            <select id="regionFilter" onchange="filterBranches()">
                <option value="all">전체</option>
                {% for region in regions %}
                <option value="{{ region.name }}">{{ region.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="monitor-filter">
            <label>검색</label>
            <input id="searchFilter" placeholder="지점명 입력" oninput="filterBranches()">
        </div>
        <button class="ghost-button small" onclick="filterBranches()">검색</button>
    </div>
    <div class="monitor-grid" id="branchGrid">
        {% for branch in branches %}
        <div class="monitor-card" data-region="{{ branch.region.name }}" data-name="{{ branch.name }}">
            <div class="monitor-header">
                <h3>{{ branch.name }}</h3>
                <span class="mono">{{ branch.region.name }}</span>
            </div>
            <div class="monitor-video">
                <div class="video-placeholder">전지점 요약 화면</div>
            </div>
            <div class="monitor-footer">
                <div class="viewer-meta">
                    카메라: {{ branch.get_camera_count }}대<br>
                    <span class="mono">오늘 이벤트: {{ branch.get_today_event_count }}건</span>
                </div>
                <a href="{% url 'cctv:monitor_local_branch' branch.id %}" class="ghost-button small">현장보기</a>
            </div>
        </div>
        {% empty %}
        <div class="empty-text">등록된 지점이 없습니다.</div>
        {% endfor %}
    </div>
</div>

<script>
function filterBranches() {
    const region = document.getElementById('regionFilter').value;
    const search = document.getElementById('searchFilter').value.toLowerCase();
    const cards = document.querySelectorAll('.monitor-card');
    
    cards.forEach(card => {
        const cardRegion = card.dataset.region;
        const cardName = card.dataset.name.toLowerCase();
        
        const regionMatch = region === 'all' || cardRegion === region;
        const searchMatch = cardName.includes(search);
        
        card.style.display = regionMatch && searchMatch ? 'flex' : 'none';
    });
}
</script>
{% endblock %}
