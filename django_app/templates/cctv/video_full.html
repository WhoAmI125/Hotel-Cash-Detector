{% extends 'cctv/base.html' %}

{% block title %}풀영상 - Hotel CCTV Monitoring{% endblock %}

{% block content %}
<div class="panel">
    <div class="page-header">
        <div>
            <p class="eyebrow">전체 영상</p>
            <h1>풀영상 목록</h1>
        </div>
        <div class="top-actions">
            <button class="ghost-button" onclick="window.location.reload()">새로고침</button>
        </div>
    </div>
    
    {% if user.is_admin %}
    <form class="filters" method="get">
        <div class="filter-group">
            <label>날짜</label>
            <input type="date" name="date" value="{{ filters.date }}">
        </div>
        <div class="filter-group">
            <label>지역</label>
            <select name="region">
                <option value="all" {% if filters.region == 'all' %}selected{% endif %}>전체</option>
                {% for region in regions %}
                <option value="{{ region.name }}" {% if filters.region == region.name %}selected{% endif %}>{{ region.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="filter-group">
            <label>지점명</label>
            <input name="branch" placeholder="지점 검색" value="{{ filters.branch }}">
        </div>
        <button class="ghost-button small" type="submit">검색</button>
    </form>
    {% endif %}
    
    <div class="table video-full">
        <div class="table-head">
            <span>지점</span>
            <span>지역</span>
            <span>날짜</span>
            <span>파일 ID</span>
        </div>
        <div class="table-body">
            {% for video in videos %}
            <div class="table-row events">
                <span class="branch-name">{{ video.branch.name }}</span>
                <span>{{ video.branch.region.name }}</span>
                <span class="mono">{{ video.recorded_date|date:"Y-m-d" }}</span>
                <button class="link-button" onclick="showVideoModal('{{ video.branch.name }}', '{{ video.recorded_date|date:"Y-m-d" }}', '{{ video.file_id }}')">
                    영상 보기
                </button>
            </div>
            {% empty %}
            <div class="table-row empty-row">
                <span class="empty-text">영상이 없습니다.</span>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Video Modal -->
<div id="videoModal" class="modal-backdrop" style="display: none;" onclick="closeVideoModal()">
    <div class="modal" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h3 id="videoModalTitle">영상 보기</h3>
            <button class="ghost-button small" onclick="closeVideoModal()">닫기</button>
        </div>
        <div class="modal-body">
            <div class="modal-video" id="videoModalContent">
                영상 로딩 중...
            </div>
            <div class="modal-meta" id="videoModalMeta">
                <span class="mono">-</span>
                <span class="status-col">다운로드 준비</span>
            </div>
        </div>
    </div>
</div>

<script>
function showVideoModal(branch, date, fileId) {
    document.getElementById('videoModalTitle').textContent = `${branch} · ${date}`;
    document.getElementById('videoModalContent').innerHTML = '영상 보기';
    document.getElementById('videoModalMeta').innerHTML = `
        <span class="mono">${date}</span>
        <span class="status-col">파일: ${fileId}</span>
    `;
    document.getElementById('videoModal').style.display = 'flex';
}

function closeVideoModal() {
    document.getElementById('videoModal').style.display = 'none';
}
</script>
{% endblock %}
